<!DOCTYPE html>
<html>
<head>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> <!-- JQUERY NEEDED FOR OAUTH.IO -->
	<script src="oauth.js"></script> <!-- LOAD OAUTH.IO LIBRARY -->
	<script type="text/javascript">

		OAuth.initialize('5vkmIM6hUNhZSmrm928sTX0Hg0o'); //initialize OAuth.io library, use their key which points to our key on the backend
		var version = OAuth.getVersion(); //get version

		var screenname;
		var userid;
		var str;
		var imgarray = new Array();
		var imgcount = 0;


	function twitterLogin(){
		
		OAuth.popup('twitter') //start twitter login
		.done(function(result){
		
			//perform API calls if successful
			console.log(result);
			console.log(version);

			//ME call test
			//API CALL
			result.me()
			.done(function (response) {
				console.log('Screen Name: ', response.raw.screen_name);//Screen Name
				console.log('User ID: ', response.id);//USER ID
				console.log("Me Response: ", response); //What is my json
				//Store what is needed to make other calls as variables
				screenname = response.raw.screen_name; 
				userid = response.id;	
				document.getElementById("userinfo").innerHTML+="<p>" + screenname + "</br>" + userid + "</p>";
			})
			.fail(function(err){
				console.log(err); //Show error
			});


			//Make a call to get tweets
			result.get('1.1/statuses/user_timeline.json?count=10&screen_name=jesseleigh_yo') //return 5 latest tweets
    			.done(function (response) {
        		// response is an object containing the response fields
        		console.log("Tweet JSON: ", response); //Returns JSON of tweets to the console


        		for (var i = 0; i < response.length; i++) { //Loop through tweets

	        		if(response[i].extended_entities===undefined){ //if there isn't media on the tweet
		        		//document.getElementById("tweets").innerHTML += "</br>" + response[i].text;//print tweet
	        			//console.log("No Pic: ",response[i]);
	        			
	        		}else{
	        			for (var j = 0; j < response[i].extended_entities.media.length; j++) { //loop through all media

	        				console.log(response[i].extended_entities.media[j]); //what does my media look like


	        			var str = response[i].extended_entities.media[j].media_url; //Grab the URL
		        		document.getElementById("tweets").innerHTML += "</br>" + response[i].text;//print tweet
		        		document.getElementById("tweets").innerHTML += "</br><img onclick='getSource(this)' id='twitpic"+i+j+"'src='" +str+ ":thumb'/>" //print image, pass the image to the function
		        		var source = document.getElementById("twitpic"+i+j).getAttribute('src'); //get the source

		        		//need to add on click to all img tags
		        		//need to get source from image clicked
		        		//HOW THE FUCK DO I DO THISSSSS

		        		//tried adding document.getElementsByTagNames().addEventListener
		        		//and .onclick
		        		//tried by ID, problem is it gets over written
		        		//tried creating an image array and adding images, but not clicking the right ones..
		        		//tried creating function and passing click event
		        		//tried hard coding inline click function


		        		//FOR TUESDAY
		        		//create image array
		        		//add sources to image array
		        		//add ids to image array
		        		//use those for the clicks
		        		//display images from the image array (this could work)



		        		//document.getElementById("twitpic"+i+j).onclick = function(){
		        		//	console.log(source);
		        		//}



		        		//document.getElementById("tweets").innerHTML += "</br>Source: " + source; //print the source
		        		//console.log("Pic:", response[i]);

		        		}; //end inner for
		        		
	        		}//end if else
        		}; //end for loop
        		//NOW DISPLAY IMAGES

        		
    			}) //END OF .done


    			.fail(function (error) {
        		// handle errors here
        		console.log(error); //returns error message
    			});




			//TESTING
			document.getElementById("login").innerHTML="<b><p>LOGGED IN</p></b><br>";

		})
		
		.fail(function(error){
			//Handle errors if popup fails
			console.log(version);
			console.log(error);
		});



	}

	function getSource(e){ //take the image
		alert(e.src); //print the source
	}

	</script>

	<title>Twitter Test App</title>

</head>
<body>
	<!-- DISPLAY -->
	<div id="titleBox" align="center">
		<h1>Twitter Test App</h1>
	<div id="login" align = "center">
		<br>
	<img src="twittersignin.png" onclick="twitterLogin()" />
	</div>
	<div id="userinfo" align = "center">
		<h2>User Info:</h2>
	</div>
	<div id="tweets" align = "center">
		<h2>Tweets: </h2>
	</div>

</body>
</html>